<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">

  <style>
</style>

</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-md-6 offset-md-3">
        <div class="form_connexion">
        
        <!-- Sign Up Form -->
        <form id="signupForm" style="display: none;">
          <div class="title_container">
            <p class="title">Inscrivez-vous</p>
            <span class="subtitle">Créez un compte et profitez de l'expérience éco-responsable de la communauté.</span>
          </div>
          <div class="form-connexion">
            <label for="email">Email</label>
            <input type="email" class="form-control" id="email" required>
          </div>
          <div class="form-connexion">
            <label for="password">Mot de passe</label>
            <input type="password" class="form-control" id="password" required>
          </div>
          <div class="form-connexion">
            <label for="pseudo">Pseudo</label>
            <input type="text" class="form-control" id="pseudo" required>
          </div>
          <div class="form-connexion">
            <label for="localisation">Localisation</label>
            <input type="text" class="form-control" id="localisation" required>
          </div>
          <button id="submit" type="submit" class="log-in_btn">Inscription</button>
          <p>Déjà inscris? <a href="#" id="switchToLogin">Connexion</a></p>
        </form>
        
        <!-- Login Form -->
        <form id="loginForm">
          <div class="title_container">
            <p class="title">Connectez-vous</p>
            <span class="subtitle">Créez un compte et profitez de l'expérience éco-responsable de la communauté.</span>
          </div>
          <div class="form-connexion">
            <label for="loginEmail">Email</label>
            <input type="email" class="form-control" id="loginEmail" required>
          </div>
          <div class="form-connexion">
            <label for="loginPassword">Mot de passe</label>
            <input type="password" class="form-control" id="loginPassword" required>
          </div>
          <button type="submit" class="log-in_btn">Connexion</button>
          <p> Pas de compte? <a href="#" id="switchToSignup">Inscription</a></p>
        </form>
      </div>
    </div>
  </div>
</div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

  <script>
    // Fonction pour basculer vers le formulaire d'inscription
    function switchToSignup() {
      document.getElementById('signupForm').style.display = 'block';
      document.getElementById('loginForm').style.display = 'none';
    }
  
    // Fonction pour basculer vers le formulaire de connexion
    function switchToLogin() {
      document.getElementById('signupForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    }
  
    // Fonction pour gérer la soumission du formulaire d'inscription
    function handleSignup(event) {
      event.preventDefault();
  
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const pseudo = document.getElementById('pseudo').value;
      const localisation = document.getElementById('localisation').value;
  
      fetch('https://terrashift-backend.onrender.com/api/users/signup', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email: email, password: password, pseudo: pseudo, localisation: localisation })
      })
        .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            throw new Error('Une erreur est survenue lors de l\'inscription. Veuillez réessayer.');
            document.querySelector('.error-message').textContent = 'Une erreur est survenue lors de l\'inscription. Veuillez réessayer.';
          }
        })
        .then(data => {
          // Gérer la réponse JSON après l'inscription réussie
          const token = data.token;
          // Stocker le token dans le local storage ou dans un cookie si nécessaire
  
          // Afficher un message de confirmation d'inscription
          document.querySelector('.message').textContent = 'Inscription réussie !';
        })
        .catch(error => {
          console.error(error);
        });
    }
  
    // Fonction pour gérer la soumission du formulaire de connexion
    function handleLogin(event) {
      event.preventDefault();
  
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
  
      fetch('https://terrashift-backend.onrender.com/api/users/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email: email, password: password})
      })
        .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            throw new Error('Une erreur est survenue lors de la connexion. Veuillez réessayer.');
            document.querySelector('.error-message').textContent = 'Email ou mot de passe incorrect.';
          }
        })
        .then(data => {
          const token = data.token;
          const userEmail = data.email;
          localStorage.setItem('token', token);
          localStorage.setItem('userEmail', userEmail);

          // Rediriger vers la page suivante ou effectuer d'autres actions nécessaires après la connexion réussie
          // Vérifier les informations de connexion et rediriger en conséquence
          if (email === 'admin@mail.com') {
            // Rediriger vers la page admin.html pour l'administrateur
            window.location.href = 'https://terrashift-services.onrender.com/Admin/homeAdmin';
          } else {
            // Afficher un message d'erreur si les informations de connexion sont incorrectes
            window.location.href = 'https://terrashift-services.onrender.com/User/home';
          }
        })
        .catch(error => {
          console.error(error);
        });
    }
  
    // Ajouter des écouteurs d'événements pour les liens et les soumissions de formulaire
    document.getElementById('switchToSignup').addEventListener('click', switchToSignup);
    document.getElementById('switchToLogin').addEventListener('click', switchToLogin);
    document.getElementById('signupForm').addEventListener('submit', handleSignup);
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
  </script>
  
</body>
</html>
